<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Merge a list of stanfit objects into one — sflist2stanfit • rstan</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Merge a list of stanfit objects into one — sflist2stanfit" />
<meta property="og:description" content="This function takes a list of stanfit objects and returns a
  consolidated stanfit object. The stanfit objects to be merged
  need to have the same configuration of iteration, warmup, and thin, besides
  being from the same model.  This could facilitate some parallel usage of RStan.
  For example, if we call stan by parallel and it returns a list of
  stanfit objects, this function can be used to create one stanfit
  object from the list." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.21.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstan">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Merge a list of stanfit objects into one</h1>
    
    <div class="hidden name"><code>sflist2stanfit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function takes a list of <code>stanfit</code> objects and returns a
  consolidated <code>stanfit</code> object. The <code>stanfit</code> objects to be merged
  need to have the same configuration of iteration, warmup, and thin, besides
  being from the same model.  This could facilitate some parallel usage of RStan.
  For example, if we call <code><a href='stan.html'>stan</a></code> by parallel and it returns a list of
  <code>stanfit</code> objects, this function can be used to create one <code>stanfit</code>
  object from the list.</p>
    </div>

    <pre class="usage"><span class='fu'>sflist2stanfit</span>(<span class='no'>sflist</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sflist</th>
      <td><p>A list of <code>stanfit</code> objects.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An S4 object of <code>stanfit</code> consolidated from all the input <code>stanfit</code>
  objects.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function should be called in rare circumstances because 
  <code><a href='stanmodel-method-sampling.html'>sampling</a></code> has a <code>cores</code> argument that allows multiple
  chains to be executed in parallel. However, if you need to depart from that,
  the best practice is to use <code>sflist2stanfit</code> on a list of <code>stanfit</code>
  objects created with the same <code>seed</code> but different <code>chain_id</code> (see
  example below). Using the same seed but different chain_id can make sure 
  the random number generations for all chains are not correlated.</p>
<p>This function would do some check to see if the <code>stanfit</code> objects in the input list 
  can be merged. But the check is not sufficient. So generally, it is the
  user's responsibility to make sure the input is correct so that the merging
  makes sense.</p>
<p>The date in the new <code>stanfit</code> object is when it is merged.</p>
<p><code>get_seed</code> function for the new consolidated <code>stanfit</code> object only returns
  the seed used in the first chain of the new object.</p>
<p>The sampler such as NUTS2 that is displayed in the printout by <code>print</code> 
  is the sampler used for the first chain. The <code>print</code> method assumes the samplers
  are the same for all chains.</p>
<p>The included <code>stanmodel</code> object, which includes the compiled model, 
  in the new <code>stanfit</code> object is from the first element of the input list.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>The Stan Development Team 
  <em>Stan Modeling Language User's Guide and Reference Manual</em>. 
  <a href='http://mc-stan.org/'>http://mc-stan.org/</a>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='stan.html'>stan</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>rstan</span>)
<span class='no'>scode</span> <span class='kw'>&lt;-</span> <span class='st'>"
data {
  int&lt;lower=1&gt; N;
} 
parameters {
  real y1[N]; 
  real y2[N]; 
} 
model {
  y1 ~ normal(0, 1);
  y2 ~ double_exponential(0, 2);
} 
"</span>
<span class='no'>seed</span> <span class='kw'>&lt;-</span> <span class='fl'>123</span> <span class='co'># or any other integer </span>
<span class='no'>foo_data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>N</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='no'>foo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='stan.html'>stan</a></span>(<span class='kw'>model_code</span> <span class='kw'>=</span> <span class='no'>scode</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>foo_data</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>f1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='stan.html'>stan</a></span>(<span class='kw'>fit</span> <span class='kw'>=</span> <span class='no'>foo</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>foo_data</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='no'>seed</span>, <span class='kw'>chain_id</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>f2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='stan.html'>stan</a></span>(<span class='kw'>fit</span> <span class='kw'>=</span> <span class='no'>foo</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>foo_data</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='no'>seed</span>, <span class='kw'>chain_id</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>)
<span class='no'>f12</span> <span class='kw'>&lt;-</span> <span class='fu'>sflist2stanfit</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>f1</span>, <span class='no'>f2</span>))

<span class='co'>## parallel stan call for unix-like OS</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>parallel</span>)

<span class='kw'>if</span> (<span class='no'>.Platform</span>$<span class='no'>OS.type</span> <span class='kw'>==</span> <span class='st'>"unix"</span>) {
<span class='no'>sflist1</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></span>(<span class='fl'>1</span>:<span class='fl'>4</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>2</span>,
           <span class='kw'>function</span>(<span class='no'>i</span>) <span class='fu'><a href='stan.html'>stan</a></span>(<span class='kw'>fit</span> <span class='kw'>=</span> <span class='no'>foo</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>foo_data</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='no'>seed</span>,
                            <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>chain_id</span> <span class='kw'>=</span> <span class='no'>i</span>, <span class='kw'>refresh</span> <span class='kw'>=</span> -<span class='fl'>1</span>))
<span class='no'>f3</span> <span class='kw'>&lt;-</span> <span class='fu'>sflist2stanfit</span>(<span class='no'>sflist1</span>)
}
<span class='kw'>if</span> (<span class='no'>.Platform</span>$<span class='no'>OS.type</span> <span class='kw'>==</span> <span class='st'>"windows"</span>) { <span class='co'># also works on non-Windows</span>
<span class='no'>CL</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span>(<span class='fl'>2</span>)
<span class='fu'><a href='https://rdrr.io/r/parallel/clusterApply.html'>clusterExport</a></span>(<span class='kw'>cl</span> <span class='kw'>=</span> <span class='no'>CL</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"foo_data"</span>, <span class='st'>"foo"</span>, <span class='st'>"seed"</span>))
<span class='no'>sflist1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></span>(<span class='no'>CL</span>, <span class='fl'>1</span>:<span class='fl'>4</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>cid</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='no'>rstan</span>)
  <span class='fu'><a href='stan.html'>stan</a></span>(<span class='kw'>fit</span> <span class='kw'>=</span> <span class='no'>foo</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>foo_data</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>,
       <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>2000</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='no'>seed</span>, <span class='kw'>chain_id</span> <span class='kw'>=</span> <span class='no'>cid</span>)
})

<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>sflist2stanfit</span>(<span class='no'>sflist1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>fit</span>)
<span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>stopCluster</a></span>(<span class='no'>CL</span>)
} <span class='co'># end example for Windows </span>
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jiqiang Guo, Jonah Gabry, Ben Goodrich, Sebastian Weber.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


